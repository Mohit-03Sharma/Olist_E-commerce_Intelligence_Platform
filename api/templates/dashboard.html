<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Olist Order Satisfaction Predictor</title>
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }
        body { font-family: 'Segoe UI', Tahoma, sans-serif; background: #0f172a; color: #e2e8f0; min-height: 100vh; }

        .header { background: linear-gradient(135deg, #1e293b, #334155); padding: 2rem; text-align: center; border-bottom: 2px solid #3b82f6; }
        .header h1 { font-size: 1.8rem; color: #60a5fa; margin-bottom: 0.5rem; }
        .header p { color: #94a3b8; font-size: 0.95rem; }

        .container { max-width: 900px; margin: 2rem auto; padding: 0 1.5rem; }

        .card { background: #1e293b; border-radius: 12px; padding: 1.5rem; margin-bottom: 1.5rem; border: 1px solid #334155; }
        .card h2 { color: #60a5fa; font-size: 1.2rem; margin-bottom: 1rem; }

        .form-grid { display: grid; grid-template-columns: repeat(auto-fill, minmax(200px, 1fr)); gap: 1rem; }
        .form-group { display: flex; flex-direction: column; }
        .form-group label { font-size: 0.8rem; color: #94a3b8; margin-bottom: 0.3rem; text-transform: uppercase; letter-spacing: 0.5px; }
        .form-group input { background: #0f172a; border: 1px solid #475569; border-radius: 8px; padding: 0.6rem; color: #e2e8f0; font-size: 1rem; transition: border 0.2s; }
        .form-group input:focus { outline: none; border-color: #3b82f6; box-shadow: 0 0 0 3px rgba(59,130,246,0.2); }

        .btn { background: linear-gradient(135deg, #3b82f6, #2563eb); color: white; border: none; padding: 0.8rem 2rem; border-radius: 8px; font-size: 1rem; cursor: pointer; width: 100%; margin-top: 1rem; transition: transform 0.1s, box-shadow 0.2s; font-weight: 600; }
        .btn:hover { transform: translateY(-1px); box-shadow: 0 4px 12px rgba(59,130,246,0.4); }
        .btn:active { transform: translateY(0); }

        .result { display: none; text-align: center; }
        .result.show { display: block; }

        .risk-score { font-size: 4rem; font-weight: 800; margin: 1rem 0; }
        .risk-score.low { color: #22c55e; }
        .risk-score.medium { color: #eab308; }
        .risk-score.high { color: #ef4444; }

        .risk-tier { font-size: 1.5rem; margin-bottom: 0.5rem; }
        .risk-action { background: #0f172a; border-radius: 8px; padding: 1rem; margin-top: 1rem; color: #94a3b8; font-size: 0.95rem; border-left: 3px solid #3b82f6; }

        .stats { display: grid; grid-template-columns: repeat(3, 1fr); gap: 1rem; margin-top: 1.5rem; }
        .stat-box { background: #0f172a; border-radius: 8px; padding: 1rem; text-align: center; }
        .stat-box .value { font-size: 1.5rem; font-weight: 700; color: #60a5fa; }
        .stat-box .label { font-size: 0.75rem; color: #64748b; text-transform: uppercase; margin-top: 0.3rem; }

        .model-info { font-size: 0.8rem; color: #64748b; text-align: center; margin-top: 2rem; padding: 1rem; }

        .loading { display: none; text-align: center; padding: 2rem; }
        .loading.show { display: block; }
        .spinner { border: 3px solid #334155; border-top: 3px solid #3b82f6; border-radius: 50%; width: 40px; height: 40px; animation: spin 0.8s linear infinite; margin: 0 auto 1rem; }
        @keyframes spin { 0% { transform: rotate(0deg); } 100% { transform: rotate(360deg); } }
    </style>
</head>
<body>
    <div class="header">
        <h1>üõí Olist Order Satisfaction Predictor</h1>
        <p>Predict the risk of a negative review based on order characteristics</p>
    </div>

    <div class="container">
        <!-- Input Form -->
        <div class="card">
            <h2>üìã Order Details</h2>
            <div class="form-grid" id="inputForm">
                {% for key, feat in features.items() %}
                <div class="form-group">
                    <label>{{ feat.label }}</label>
                    <input type="number" id="{{ key }}" value="{{ feat.default }}"
                           min="{{ feat.min }}" max="{{ feat.max }}" step="any">
                </div>
                {% endfor %}
            </div>
            <button class="btn" onclick="predict()">üîç Predict Satisfaction Risk</button>
        </div>

        <!-- Loading -->
        <div class="loading" id="loading">
            <div class="spinner"></div>
            <p>Analyzing order...</p>
        </div>

        <!-- Result -->
        <div class="card result" id="result">
            <h2>üìä Prediction Result</h2>
            <div class="risk-score" id="riskScore">--</div>
            <div class="risk-tier" id="riskTier">--</div>
            <div class="risk-action" id="riskAction">--</div>

            <div class="stats">
                <div class="stat-box">
                    <div class="value" id="probValue">--</div>
                    <div class="label">Risk Probability</div>
                </div>
                <div class="stat-box">
                    <div class="value" id="tierValue">--</div>
                    <div class="label">Risk Tier</div>
                </div>
                <div class="stat-box">
                    <div class="value" id="predValue">--</div>
                    <div class="label">Prediction</div>
                </div>
            </div>
        </div>

        <div class="model-info">
            Model: {{ model_info.model_type }} | Features: {{ model_info.n_features }}
        </div>
    </div>

    <script>
        async function predict() {
            const loading = document.getElementById('loading');
            const result = document.getElementById('result');
            loading.classList.add('show');
            result.classList.remove('show');

            // Gather input values
            const data = {};
            const inputs = document.querySelectorAll('#inputForm input');
            inputs.forEach(input => { data[input.id] = parseFloat(input.value) || 0; });

            try {
                const response = await fetch('/predict', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify(data),
                });
                const res = await response.json();

                if (res.error) {
                    alert('Error: ' + res.error);
                    loading.classList.remove('show');
                    return;
                }

                // Update UI
                const scoreEl = document.getElementById('riskScore');
                scoreEl.textContent = res.risk_score + '%';
                scoreEl.className = 'risk-score ' + (res.risk_tier === 'HIGH' ? 'high' : res.risk_tier === 'MEDIUM' ? 'medium' : 'low');

                document.getElementById('riskTier').textContent = res.risk_emoji + ' ' + res.risk_tier + ' RISK';
                document.getElementById('riskAction').textContent = 'üí° ' + res.recommended_action;
                document.getElementById('probValue').textContent = res.risk_probability.toFixed(4);
                document.getElementById('tierValue').textContent = res.risk_tier;
                document.getElementById('predValue').textContent = res.prediction === 1 ? '‚ö†Ô∏è Negative' : '‚úÖ Positive';

                loading.classList.remove('show');
                result.classList.add('show');
            } catch (err) {
                alert('Request failed: ' + err.message);
                loading.classList.remove('show');
            }
        }
    </script>
</body>
</html>